using System;
using System.IO;
using System.Linq;
using DocumentFormat.OpenXml.Packaging;
using DocumentFormat.OpenXml.Wordprocessing;
using System.Text.RegularExpressions;

class Program
{
    static void Main(string[] args)
    {
        string filePath = "test.docx"; // Path to your .docx file
        try
        {
            FixFalsePositiveNumbers(filePath);
            Console.WriteLine("False Positive numbers corrected successfully.");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"An error occurred: {ex.Message}");
        }
    }

    static void FixFalsePositiveNumbers(string filePath)
    {
        // Ensure the file exists
        if (!File.Exists(filePath))
        {
            throw new FileNotFoundException("The specified file was not found.");
        }

        // Open the Word document
        using (WordprocessingDocument wordDoc = WordprocessingDocument.Open(filePath, true))
        {
            // Get the document's main body content
            Body body = wordDoc.MainDocumentPart.Document.Body;

            if (body == null)
            {
                throw new InvalidOperationException("The document body is empty.");
            }

            // Regular expression to match False Positive entries
            Regex falsePositiveRegex = new Regex(@"--- False Positive (\d+):", RegexOptions.Compiled);

            // Counter for the new numbering
            int newNumber = 1;

            // Iterate through all paragraphs in the document body
            foreach (var paragraph in body.Descendants<Paragraph>())
            {
                foreach (var run in paragraph.Elements<Run>())
                {
                    foreach (var text in run.Elements<Text>())
                    {
                        // Check if the text matches the "False Positive" pattern
                        if (falsePositiveRegex.IsMatch(text.Text))
                        {
                            // Replace the numbering with the correct sequence
                            text.Text = falsePositiveRegex.Replace(text.Text, $"--- False Positive {newNumber++}:");
                        }
                    }
                }
            }

            // Save the updated document
            wordDoc.MainDocumentPart.Document.Save();
        }
    }
}
